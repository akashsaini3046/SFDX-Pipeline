@isTest(SeeAllData=false)
public class CC_IdeaFileUploadControllerTest {
  @testSetup
  static void setup() {
    Community community = [
      SELECT Id
      FROM Community
      WHERE IsActive = TRUE
      ORDER BY Name ASC
      LIMIT 1
    ];
    List<Idea> ideaList = TestDataUtility.getIdeaRecords(
      community.Id,
      'Strategy',
      2,
      true
    );
  }

  @isTest
  static void saveChunkTestCase1() {
    Idea idea = [SELECT id FROM Idea LIMIT 1];
    String base64Data = 'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDIyOS4wMTggMjI5LjAxOCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjI5LjAxOCAyMjkuMDE4OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8cGF0aCBkPSJNMTE0LjUxMiw1MS43NDNjLTMyLjY2OSwwLTU5LjI0OCwyNi41NzktNTkuMjQ4LDU5LjI0OGMwLDEzLjM3LDQuMzg0LDI2LjAwMywxMi42NzIsMzYuNTI3DQoJCWMxLjYzNiwyLjA4MywzLjM1NSw0LjA3Nyw1LjE3NSw2LjE4OGwwLjEsMC4xMTZjNS41NjgsNi40NiwxMS4zMjUsMTMuMTQyLDEzLjQ3NSwyMS4wMWMwLjQ4NiwxLjgwMywwLjU1NSw1LjI2LDAuNTI3LDcuOTIzdjQuNTI2DQoJCWMwLDQuMTQyLDMuMzU4LDcuNSw3LjUsNy41aDM5LjI3MmM0LjE0MiwwLDcuNS0zLjM1OCw3LjUtNy41di00LjU3OWMtMC4wMjUtMy40NzgsMC4xNTUtNi4wMTYsMC41MTgtNy4zMzMNCgkJYzIuMTYyLTcuODE2LDguNTQyLTE1LjMyMSwxNC4yMjItMjIuMDAxbDAuMjQ1LTAuMjg4YzEuNjM5LTEuOTI2LDMuMTg4LTMuNzQ1LDQuNTk4LTUuNTM4YzguMy0xMC41MywxMi42ODctMjMuMTY5LDEyLjY4Ny0zNi41NTENCgkJQzE3My43NTQsNzguMzIyLDE0Ny4xNzgsNTEuNzQzLDExNC41MTIsNTEuNzQzeiBNMTQ5LjI4MSwxMzguMjY0Yy0xLjIzNSwxLjU3MS0yLjY5MSwzLjI4Mi00LjIzMyw1LjA5M2wtMC4zMDIsMC4zNTUNCgkJYy02LjYzNSw3LjgwNC0xNC4xNTUsMTYuNjQ5LTE3LjIwMywyNy42NjdjLTAuNDMxLDEuNTY0LTAuOTEsMy45MDQtMS4wMzIsOC40MDJoLTI0LjMxMmMtMC4xMDQtNC43NzctMC41OTEtNy4yMjctMS4wMzYtOC44NzcNCgkJYy0zLjA1LTExLjE2NC0xMC41NTctMTkuODc1LTE2LjU5LTI2Ljg3NmwtMC4xMDEtMC4xMThjLTEuNzA1LTEuOTc3LTMuMzE1LTMuODQ1LTQuNzQ2LTUuNjY1DQoJCWMtNi4xOS03Ljg2LTkuNDYyLTE3LjI4NS05LjQ2Mi0yNy4yNTRjMC0yNC4zOTgsMTkuODUtNDQuMjQ4LDQ0LjI0OC00NC4yNDhjMjQuMzk1LDAsNDQuMjQyLDE5Ljg1LDQ0LjI0Miw0NC4yNDgNCgkJQzE1OC43NTQsMTIwLjk3MSwxNTUuNDgsMTMwLjM5OSwxNDkuMjgxLDEzOC4yNjR6Ii8+DQoJPHBhdGggZD0iTTEzMy45ODQsMTk2LjkxSDk0LjcxM2MtNC4xNDIsMC03LjUsMy4zNTgtNy41LDcuNXMzLjM1OCw3LjUsNy41LDcuNWgzOS4yNzJjNC4xNDIsMCw3LjUtMy4zNTgsNy41LTcuNQ0KCQlTMTM4LjEyNiwxOTYuOTEsMTMzLjk4NCwxOTYuOTF6Ii8+DQoJPHBhdGggZD0iTTEyNC4xNjYsMjE0LjAxOGgtMTkuNjM1Yy00LjE0MiwwLTcuNSwzLjM1OC03LjUsNy41YzAsNC4xNDIsMy4zNTgsNy41LDcuNSw3LjVoMTkuNjM1YzQuMTQyLDAsNy41LTMuMzU4LDcuNS03LjUNCgkJQzEzMS42NjYsMjE3LjM3NiwxMjguMzA4LDIxNC4wMTgsMTI0LjE2NiwyMTQuMDE4eiIvPg0KCTxwYXRoIGQ9Ik0yMTgsMTAzLjQ5MWgtMjUuODczYy00LjE0MiwwLTcuNSwzLjM1OC03LjUsNy41YzAsNC4xNDIsMy4zNTgsNy41LDcuNSw3LjVIMjE4YzQuMTQyLDAsNy41LTMuMzU4LDcuNS03LjUNCgkJQzIyNS41LDEwNi44NDksMjIyLjE0MiwxMDMuNDkxLDIxOCwxMDMuNDkxeiIvPg0KCTxwYXRoIGQ9Ik00NC4zOTQsMTEwLjk5MWMwLTQuMTQyLTMuMzU4LTcuNS03LjUtNy41SDExLjAxOGMtNC4xNDIsMC03LjUsMy4zNTgtNy41LDcuNWMwLDQuMTQyLDMuMzU4LDcuNSw3LjUsNy41aDI1Ljg3Ng0KCQlDNDEuMDM2LDExOC40OTEsNDQuMzk0LDExNS4xMzMsNDQuMzk0LDExMC45OTF6Ii8+DQoJPHBhdGggZD0iTTExNC41MSw0MC44ODFjNC4xNDIsMCw3LjUtMy4zNTgsNy41LTcuNVY3LjVjMC00LjE0Mi0zLjM1OC03LjUtNy41LTcuNWMtNC4xNDIsMC03LjUsMy4zNTgtNy41LDcuNXYyNS44ODENCgkJQzEwNy4wMSwzNy41MjMsMTEwLjM2OCw0MC44ODEsMTE0LjUxLDQwLjg4MXoiLz4NCgk8cGF0aCBkPSJNMTc0LjY5MywxNjAuNTY5Yy0yLjkyOS0yLjkyOS03LjY3Ny0yLjkzLTEwLjYwNy0wLjAwMWMtMi45MjksMi45MjktMi45Myw3LjY3Ny0wLjAwMSwxMC42MDdsMTguMjk2LDE4LjMwMQ0KCQljMS40NjUsMS40NjUsMy4zODQsMi4xOTcsNS4zMDQsMi4xOTdjMS45MTksMCwzLjgzOC0wLjczMiw1LjMwMy0yLjE5NmMyLjkyOS0yLjkyOSwyLjkzLTcuNjc3LDAuMDAxLTEwLjYwN0wxNzQuNjkzLDE2MC41Njl6Ii8+DQoJPHBhdGggZD0iTTU0LjMxNyw2MS40MDhjMS40NjUsMS40NjUsMy4zODQsMi4xOTgsNS4zMDQsMi4xOThjMS45MTksMCwzLjgzOC0wLjczMiw1LjMwMi0yLjE5NmMyLjkzLTIuOTI5LDIuOTMtNy42NzcsMC4wMDItMTAuNjA2DQoJCUw0Ni42MzYsMzIuNTA4Yy0yLjkyOS0yLjkzLTcuNjc3LTIuOTMtMTAuNjA2LTAuMDAyYy0yLjkzLDIuOTI5LTIuOTMsNy42NzctMC4wMDIsMTAuNjA2TDU0LjMxNyw2MS40MDh6Ii8+DQoJPHBhdGggZD0iTTU0LjMyNSwxNjAuNTY5TDM2LjAyOCwxNzguODdjLTIuOTI5LDIuOTI5LTIuOTI4LDcuNjc4LDAuMDAxLDEwLjYwNmMxLjQ2NCwxLjQ2NCwzLjM4NCwyLjE5Niw1LjMwMywyLjE5Ng0KCQljMS45MTksMCwzLjgzOS0wLjczMiw1LjMwNC0yLjE5N2wxOC4yOTctMTguMzAxYzIuOTI5LTIuOTI5LDIuOTI4LTcuNjc4LTAuMDAxLTEwLjYwNkM2Mi4wMDMsMTU3LjY0LDU3LjI1NCwxNTcuNjQsNTQuMzI1LDE2MC41NjkNCgkJeiIvPg0KCTxwYXRoIGQ9Ik0xNjkuMzkzLDYzLjYwNWMxLjkxOSwwLDMuODM5LTAuNzMyLDUuMzA0LTIuMTk3bDE4LjI5Mi0xOC4yOTVjMi45MjktMi45MjksMi45MjgtNy42NzgtMC4wMDEtMTAuNjA2DQoJCWMtMi45MjktMi45MjktNy42NzgtMi45MjktMTAuNjA2LDAuMDAxbC0xOC4yOTIsMTguMjk1Yy0yLjkyOSwyLjkyOS0yLjkyOCw3LjY3OCwwLjAwMSwxMC42MDYNCgkJQzE2NS41NTQsNjIuODc0LDE2Ny40NzMsNjMuNjA1LDE2OS4zOTMsNjMuNjA1eiIvPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPC9zdmc+DQo=';
    String contentType = 'image/svg+xml';

    Test.startTest();
    Id fileId = CC_IdeaFileUploadController.saveChunk(
      idea.Id,
      'NewFile',
      base64Data,
      contentType,
      ''
    );
    Test.stopTest();

    System.assertNotEquals(null, fileId, 'Value should not be null');
  }

  @isTest
  static void saveChunkTestCase2() {
    String base64Data = 'PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjAuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPCFET0NUWVBFIHN2ZyBQVUJMSUMgIi0vL1czQy8vRFREIFNWRyAxLjEvL0VOIiAiaHR0cDovL3d3dy53My5vcmcvR3JhcGhpY3MvU1ZHLzEuMS9EVEQvc3ZnMTEuZHRkIj4NCjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDIyOS4wMTggMjI5LjAxOCIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMjI5LjAxOCAyMjkuMDE4OyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+DQo8Zz4NCgk8cGF0aCBkPSJNMTE0LjUxMiw1MS43NDNjLTMyLjY2OSwwLTU5LjI0OCwyNi41NzktNTkuMjQ4LDU5LjI0OGMwLDEzLjM3LDQuMzg0LDI2LjAwMywxMi42NzIsMzYuNTI3DQoJCWMxLjYzNiwyLjA4MywzLjM1NSw0LjA3Nyw1LjE3NSw2LjE4OGwwLjEsMC4xMTZjNS41NjgsNi40NiwxMS4zMjUsMTMuMTQyLDEzLjQ3NSwyMS4wMWMwLjQ4NiwxLjgwMywwLjU1NSw1LjI2LDAuNTI3LDcuOTIzdjQuNTI2DQoJCWMwLDQuMTQyLDMuMzU4LDcuNSw3LjUsNy41aDM5LjI3MmM0LjE0MiwwLDcuNS0zLjM1OCw3LjUtNy41di00LjU3OWMtMC4wMjUtMy40NzgsMC4xNTUtNi4wMTYsMC41MTgtNy4zMzMNCgkJYzIuMTYyLTcuODE2LDguNTQyLTE1LjMyMSwxNC4yMjItMjIuMDAxbDAuMjQ1LTAuMjg4YzEuNjM5LTEuOTI2LDMuMTg4LTMuNzQ1LDQuNTk4LTUuNTM4YzguMy0xMC41MywxMi42ODctMjMuMTY5LDEyLjY4Ny0zNi41NTENCgkJQzE3My43NTQsNzguMzIyLDE0Ny4xNzgsNTEuNzQzLDExNC41MTIsNTEuNzQzeiBNMTQ5LjI4MSwxMzguMjY0Yy0xLjIzNSwxLjU3MS0yLjY5MSwzLjI4Mi00LjIzMyw1LjA5M2wtMC4zMDIsMC4zNTUNCgkJYy02LjYzNSw3LjgwNC0xNC4xNTUsMTYuNjQ5LTE3LjIwMywyNy42NjdjLTAuNDMxLDEuNTY0LTAuOTEsMy45MDQtMS4wMzIsOC40MDJoLTI0LjMxMmMtMC4xMDQtNC43NzctMC41OTEtNy4yMjctMS4wMzYtOC44NzcNCgkJYy0zLjA1LTExLjE2NC0xMC41NTctMTkuODc1LTE2LjU5LTI2Ljg3NmwtMC4xMDEtMC4xMThjLTEuNzA1LTEuOTc3LTMuMzE1LTMuODQ1LTQuNzQ2LTUuNjY1DQoJCWMtNi4xOS03Ljg2LTkuNDYyLTE3LjI4NS05LjQ2Mi0yNy4yNTRjMC0yNC4zOTgsMTkuODUtNDQuMjQ4LDQ0LjI0OC00NC4yNDhjMjQuMzk1LDAsNDQuMjQyLDE5Ljg1LDQ0LjI0Miw0NC4yNDgNCgkJQzE1OC43NTQsMTIwLjk3MSwxNTUuNDgsMTMwLjM5OSwxNDkuMjgxLDEzOC4yNjR6Ii8+DQoJPHBhdGggZD0iTTEzMy45ODQsMTk2LjkxSDk0LjcxM2MtNC4xNDIsMC03LjUsMy4zNTgtNy41LDcuNXMzLjM1OCw3LjUsNy41LDcuNWgzOS4yNzJjNC4xNDIsMCw3LjUtMy4zNTgsNy41LTcuNQ0KCQlTMTM4LjEyNiwxOTYuOTEsMTMzLjk4NCwxOTYuOTF6Ii8+DQoJPHBhdGggZD0iTTEyNC4xNjYsMjE0LjAxOGgtMTkuNjM1Yy00LjE0MiwwLTcuNSwzLjM1OC03LjUsNy41YzAsNC4xNDIsMy4zNTgsNy41LDcuNSw3LjVoMTkuNjM1YzQuMTQyLDAsNy41LTMuMzU4LDcuNS03LjUNCgkJQzEzMS42NjYsMjE3LjM3NiwxMjguMzA4LDIxNC4wMTgsMTI0LjE2NiwyMTQuMDE4eiIvPg0KCTxwYXRoIGQ9Ik0yMTgsMTAzLjQ5MWgtMjUuODczYy00LjE0MiwwLTcuNSwzLjM1OC03LjUsNy41YzAsNC4xNDIsMy4zNTgsNy41LDcuNSw3LjVIMjE4YzQuMTQyLDAsNy41LTMuMzU4LDcuNS03LjUNCgkJQzIyNS41LDEwNi44NDksMjIyLjE0MiwxMDMuNDkxLDIxOCwxMDMuNDkxeiIvPg0KCTxwYXRoIGQ9Ik00NC4zOTQsMTEwLjk5MWMwLTQuMTQyLTMuMzU4LTcuNS03LjUtNy41SDExLjAxOGMtNC4xNDIsMC03LjUsMy4zNTgtNy41LDcuNWMwLDQuMTQyLDMuMzU4LDcuNSw3LjUsNy41aDI1Ljg3Ng0KCQlDNDEuMDM2LDExOC40OTEsNDQuMzk0LDExNS4xMzMsNDQuMzk0LDExMC45OTF6Ii8+DQoJPHBhdGggZD0iTTExNC41MSw0MC44ODFjNC4xNDIsMCw3LjUtMy4zNTgsNy41LTcuNVY3LjVjMC00LjE0Mi0zLjM1OC03LjUtNy41LTcuNWMtNC4xNDIsMC03LjUsMy4zNTgtNy41LDcuNXYyNS44ODENCgkJQzEwNy4wMSwzNy41MjMsMTEwLjM2OCw0MC44ODEsMTE0LjUxLDQwLjg4MXoiLz4NCgk8cGF0aCBkPSJNMTc0LjY5MywxNjAuNTY5Yy0yLjkyOS0yLjkyOS03LjY3Ny0yLjkzLTEwLjYwNy0wLjAwMWMtMi45MjksMi45MjktMi45Myw3LjY3Ny0wLjAwMSwxMC42MDdsMTguMjk2LDE4LjMwMQ0KCQljMS40NjUsMS40NjUsMy4zODQsMi4xOTcsNS4zMDQsMi4xOTdjMS45MTksMCwzLjgzOC0wLjczMiw1LjMwMy0yLjE5NmMyLjkyOS0yLjkyOSwyLjkzLTcuNjc3LDAuMDAxLTEwLjYwN0wxNzQuNjkzLDE2MC41Njl6Ii8+DQoJPHBhdGggZD0iTTU0LjMxNyw2MS40MDhjMS40NjUsMS40NjUsMy4zODQsMi4xOTgsNS4zMDQsMi4xOThjMS45MTksMCwzLjgzOC0wLjczMiw1LjMwMi0yLjE5NmMyLjkzLTIuOTI5LDIuOTMtNy42NzcsMC4wMDItMTAuNjA2DQoJCUw0Ni42MzYsMzIuNTA4Yy0yLjkyOS0yLjkzLTcuNjc3LTIuOTMtMTAuNjA2LTAuMDAyYy0yLjkzLDIuOTI5LTIuOTMsNy42NzctMC4wMDIsMTAuNjA2TDU0LjMxNyw2MS40MDh6Ii8+DQoJPHBhdGggZD0iTTU0LjMyNSwxNjAuNTY5TDM2LjAyOCwxNzguODdjLTIuOTI5LDIuOTI5LTIuOTI4LDcuNjc4LDAuMDAxLDEwLjYwNmMxLjQ2NCwxLjQ2NCwzLjM4NCwyLjE5Niw1LjMwMywyLjE5Ng0KCQljMS45MTksMCwzLjgzOS0wLjczMiw1LjMwNC0yLjE5N2wxOC4yOTctMTguMzAxYzIuOTI5LTIuOTI5LDIuOTI4LTcuNjc4LTAuMDAxLTEwLjYwNkM2Mi4wMDMsMTU3LjY0LDU3LjI1NCwxNTcuNjQsNTQuMzI1LDE2MC41NjkNCgkJeiIvPg0KCTxwYXRoIGQ9Ik0xNjkuMzkzLDYzLjYwNWMxLjkxOSwwLDMuODM5LTAuNzMyLDUuMzA0LTIuMTk3bDE4LjI5Mi0xOC4yOTVjMi45MjktMi45MjksMi45MjgtNy42NzgtMC4wMDEtMTAuNjA2DQoJCWMtMi45MjktMi45MjktNy42NzgtMi45MjktMTAuNjA2LDAuMDAxbC0xOC4yOTIsMTguMjk1Yy0yLjkyOSwyLjkyOS0yLjkyOCw3LjY3OCwwLjAwMSwxMC42MDYNCgkJQzE2NS41NTQsNjIuODc0LDE2Ny40NzMsNjMuNjA1LDE2OS4zOTMsNjMuNjA1eiIvPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPGc+DQo8L2c+DQo8Zz4NCjwvZz4NCjxnPg0KPC9nPg0KPC9zdmc+DQo=';
    String contentType = 'image/svg+xml';
    String fileName = 'NewFile';
    List<Idea> ideas = [
      SELECT Id, AttachmentBody, AttachmentName, AttachmentContentType
      FROM Idea
    ];
    if (!ideas.isEmpty()) {
      ideas[0].AttachmentBody = EncodingUtil.base64Decode(base64Data);
      ideas[0].AttachmentName = fileName;
      ideas[0].AttachmentContentType = String.isBlank(contentType)
        ? 'text/plain'
        : contentType;
      update ideas[0];
    }

    Test.startTest();
    Id fileId = CC_IdeaFileUploadController.saveChunk(
      ideas[0].Id,
      'UpdateFile',
      base64Data,
      contentType,
      ideas[0].Id
    );
    Test.stopTest();

    System.assertNotEquals(null, fileId, 'Value should not be null');
  }

  @isTest
  static void saveChunkTestCaseNegative() {
    Blob data = Blob.valueOf('a'.repeat(5242880));
    String base64Data = EncodingUtil.base64Encode(data);
    String contentType = 'image/svg+xml';
    String fileName = 'NewFile';
    Boolean isError = false;
    List<Idea> ideas = [
      SELECT Id, AttachmentBody, AttachmentName, AttachmentContentType
      FROM Idea
    ];
    System.debug('');
    if (!ideas.isEmpty()) {
      ideas[0].AttachmentBody = EncodingUtil.base64Decode(base64Data);
      ideas[0].AttachmentName = fileName;
      ideas[0].AttachmentContentType = String.isBlank(contentType)
        ? 'text/plain'
        : contentType;
      update ideas[0];
    }
    Test.startTest();
    try {
      Id fileId = CC_IdeaFileUploadController.saveChunk(
        ideas[0].Id,
        'UpdateFile',
        base64Data,
        contentType,
        ideas[0].Id
      );
    } catch (Exception ex) {
      isError = true;
    }
    Test.stopTest();

    System.assertEquals(true, isError, 'Should have thrown error');
  }
}
